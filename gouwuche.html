<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/gouwuche.css">
</head>
<body>
     <!--导航条部分-->
     <div id="nav">
            <div class="nav1">
                <p class="hello" >Hi,欢迎来到永乐!</p>
                <p class="add">
                    <a href="#">
                        添加收藏
                    </a>
                </p>
                <p class="system">
                    <span class="span1">
                        [
                    </span>     
                        <a href="#" class="login">
                            登录
                        </a>
                        <a href="#" class="register">
                                注册
                        </a>
                    <span class="span2">
                        ]
                    </span>
                </p>
                <div class="my">
                    <ul>
                        <li>
                            <a class="yl"  href="#">
                                <p>我的永乐</p>
                                <em></em>
                            </a>
                            <div class="li1-1">
                                <span>
                                    <a href="#">
                                        我的订单
                                    </a>
                                </span>
                                <span>
                                    <a href="#">
                                        电子钱包
                                    </a>
                                </span>
                                <span>
                                    <a href="#">
                                        我的乐通卡
                                    </a>
                                </span>
                                <span>
                                    <a href="#">
                                        我的积分
                                    </a>
                                </span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="nav2">
                <div class="dh">
                    <ul>
                        <li>
                            <div class="hz">
                                <a class="dao" href="#">
                                    <p>永乐导航</p>
                                    <em></em>
                                </a>
                                <div class="menu2">
                                        <div class="menu2-first">
                                            <span class="channel">频道:</span>
                                                <a class="ticket"  href="#">
                                                    <p>门票</p>
                                                </a>
                                                <a class="special"  href="#">
                                                    <p>专题会</p>
                                                </a>
                                                <a class="venue"  href="#">
                                                    <p>场馆库</p>
                                                </a>
                                                <a  class="newest"  href="#">
                                                    <p>最新资讯</p>
                                                </a>
                                                <a   class="integral"  href="#">
                                                    <p>积分商城</p>
                                                </a>    
                                        </div>
                                        <div class="menu2-second">
                                                <span class="classify">分类:</span>
                                                <a class="vocal"  href="#">
                                                    <p>演唱会</p>
                                                </a>
                                                <a class="music"  href="#">
                                                    <p>音乐会</p>
                                                </a>
                                                <a class="drama"  href="#">
                                                    <p>话剧舞台剧</p>
                                                </a>
                                                <a  class="dance"  href="#">
                                                    <p>舞蹈芭蕾</p>
                                                </a>
                                                <a   class="opera"  href="#">
                                                    <p>戏曲综艺</p>
                                                </a>  
                                                <a class="child"  href="#">
                                                    <p>儿童亲子</p>
                                                </a>
                                                <a class="entertainment"  href="#">
                                                    <p>休闲娱乐</p>
                                                </a>
                                                <a class="pm"  href="#">
                                                    <p>体育赛事</p>
                                                </a>     
                                        </div>
    
                                        <div class="menu2-third">
                                                <span class="area">地区:</span>
                                                <a class="bj"  href="#">
                                                    <p>北京</p>
                                                </a>
                                                <a class="sh"  href="#">
                                                    <p>上海</p>
                                                </a>
                                                <a class="gz"  href="#">
                                                    <p>广州</p>
                                                </a>
                                                <a  class="sz"  href="#">
                                                    <p>深圳</p>
                                                </a>
                                                <a   class="tj"  href="#">
                                                    <p>天津</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>南京</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>成都</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>重庆</p>
                                                </a>  
                                                <a class="tj"  href="#">
                                                    <p>郑州</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>西安</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>武汉</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>长沙</p>
                                                </a>
                                                <a class="tj"  href="#">
                                                    <p>合肥</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>济南</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>佛山</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>无锡</p>
                                                </a>    
                                                <a   class="tj"  href="#">
                                                    <p>苏州</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>香港</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>杭州</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>石家庄</p>
                                                </a>  
                                                <a class="tj"  href="#">
                                                    <p>青岛</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>大连</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>丽江</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>阳江</p>
                                                </a>
                                                <a class="tj"  href="#">
                                                    <p>芜湖</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>贵阳</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>绍兴</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>绵阳</p>
                                                </a>
                                                <a   class="tj"  href="#">
                                                    <p>洛阳</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>常州</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>宁波</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>温州</p>
                                                </a>  
                                                <a class="tj"  href="#">
                                                    <p>青岛</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>南昌</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>威海</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>厦门</p>
                                                </a>
                                                <a class="tj"  href="#">
                                                    <p>珠海</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>福州</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>西宁</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>昆明</p>
                                                </a>
                                                <a   class="tj"  href="#">
                                                    <p>澳门</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>南宁</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>长春</p>
                                                </a>
                                                <a class="cq"  href="#">
                                                    <p>哈尔滨</p>
                                                </a>  
                                                <a class="tj"  href="#">
                                                    <p>徐州</p>
                                                </a>  
                                                <a class="nj"  href="#">
                                                    <p>太原</p>
                                                </a>
                                                <a class="cd"  href="#">
                                                    <p>潍坊<p>
                                                </a>
                                                
                                        </div>    
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
    
                <div class="iphone">
                    <ul>
                        <li>
                            <div class="cel">
                                <a class="icon" href="#">
                                    <p>手机永乐</p>
                                </a>
                                <div class="erweima">
                                    <img src="http://static.228.com.cn/resources/images/f-ermmobile.png">
                                    <a href="https://www.228.com.cn/zhuanti/app2014ios/" target="blank"  class="ios">
                                        iOS版点我
                                    </a>
                                    <a href="https://www.228.com.cn/zhuanti/app2014/" target="blank" class="Android">
                                        Android版点我
                                    </a>
                                </div>
                        </div>
                        </li>
                    </ul>
                </div>
                <div class="online">
                    <a class="service" href="#">
                        在线客服
                    </a>
                </div>
                <div class="help">
                    <a class="center" href="#">
                        在线客服
                    </a>
                </div>
                <button class="wb">
                    <img class="weibo" src="images/weibo.jpg">
                    <p>已关注</p>
                </button>
            </div>
    </div>


    <!--section部分———top-->
    <div id="section-top">
        <div class="top1">
            <h1>
                <img src="images/pic3.jpg">
            </h1>
            <div class="selection">
                <p class="china">全国</p>
                <button class="cut">切换城市</button>
            </div>
            <div class="search">
                <form>
                    <input class="txt" type="text">
                    <input class="sou" type="button" value="搜索">
                </form>
                <div class="hot">
                    <span class="major">热门：</span>
                    <a class="bolin" href="#">柏林爱乐</a>
                    <a class="zxy" href="#">张学友</a>
                    <a class="lyd" href="#">李云迪</a>
                    <a class="xtx" href="#">谢天笑</a>
                    <a class="ynw" href="#">杨乃文</a>
                    <a class="more" href="#">更多</a>
                </div>
            </div>
             <div class="shopCar">
                <div class="empty"> 
                    <span></span>
                    <ul class="goods-list">
                        <li>
                            <img src="images/pic107.jpg">
                            <h3>我是标题</h3>
                            <strong>100</strong>
                        </li>
                    </ul>
                </div> 
            </div>
        </div>
    </div>

    <!--seciton部分————nav部分-->
    <div id="section-nav">
        <div class="goods">
            <a class="all" href="#">
                全部商品分类
            </a>
        </div>   
        <a class="top-page" href="#">
            首页
        </a>
        <a class="top-sing" href="#">
            演唱会
        </a>
        <a class="top-page" href="#">
            戏剧
        </a>
        <a class="top-dance" href="#">
            舞蹈古典
        </a>
        <a class="top-dance" href="#">
            戏曲综艺
        </a>
        <a class="top-page" href="#">
            亲子
        </a>
        <a class="top-page" href="#">
            体育
        </a>
        <a class="top-page" href="#">
            电影
        </a>
        <a class="top-dance" href="#">
            故宫订票
        </a>
        <a class="top-country" href="#">
            国家大剧院
        </a>
    </div>

    <!--section-one部分-->
    <div id="section-one">
        <a href="#">永乐票务</a>
        <p><</p>
        <h3>全部分类</h3> 
    </div>

    <!--section-two部分-->
    <div id="section-two">
        <div class="city">
            <div class="town">
                城市:
            </div>

            <ul>
                <li class="li1">
                    <a href="#">全部</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">北京</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">上海</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">广州</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">深圳</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">天津</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">南京</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">成都</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">重庆</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">郑州</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">西安</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">长沙</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">武汉</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">合肥</a>
                </li>
                <li>| </li> 
                <li class="li15">
                    <a href="#">其他城市</a>
                </li>
                
            </ul>
        </div>

        <div class="classify">
            <div class=" assortment">
                分类:
            </div>

            <ul>
                <li class="li1">
                    <a href="#">全部</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">演唱会</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">话剧舞台剧</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">音乐剧</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">舞蹈芭蕾</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">戏曲综艺</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">体育赛事</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">儿童亲子</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">休闲娱乐</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">周边商品</a>
                </li>
                <li>|</li>
                <li class="li15">
                    <a href="#">电影</a>
                </li>
                
                
            </ul>
        </div>

        <div class="city">
            <div class="town">
                日期:
            </div>

            <ul>
                <li class="li1">
                    <a href="#">全部</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">今天</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">明天</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">本周内</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">周末</a>
                </li>
                <li>|</li>
                <li>
                    <a href="#">本月</a>
                </li>
                
            </ul>
        </div>
    </div>

    <!--购物车-->
    <div class="container">
        <ul>
            <!-- <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li> -->
            <!-- <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li>
            <li>
                <img src="images/pic107.jpg">
                <h3>这是一个标题</h3>
                <button>加入购物车</button>
            </li> -->
        </ul>
    </div>

    <script src="js/jquery-3.3.1.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script>
        function ShopCar(){

        }
        $.extend(ShopCar.prototype,{
            init:function(){
                this.main =$(".container ul")
                this.loadJson()
                .then(function(res){
                    this.json=res.subjects;
                    this.renderPage()
                })
                this.bindEvent();
                this.listSum();

            },
            loadJson:function(){
                var opt={
                    url:"php/data.json",
                    data:{start:0,count:10},
                    type:"GET",
                    context:this

                }
                return $.ajax(opt);
            },
            renderPage:function(){
                console.log(this.json)
                var html="";
                for(var i=0 ;i<this.json.length;i++){
                    html += `<li>
                                <img src="${this.json[i].images.small.replace(/\.jpg/g,".webp")}" alt="">
                                <h3>${this.json[i].title}</h3>
                                <button data-id=${this.json[i].id}>加入购物车</button>
                            </li>`
                }
                this.main.html(html);

            },
            bindEvent:function(){
                $(".container ul").on("click","button",this.addCar.bind(this));
                $(".shopCar>div").on("mouseenter",this.showList.bind(this));
                $(".shopCar>div").on("mouseleave",function(){
                    $(".goods-list").children().remove();
                });
                $(".shopCar>div").on("click",function(event){
                    var target = event.target ; 
                    if(target != $(".shopCar>div")[0]) return 0;

                    $.removeCookie("shopCar");
                    // 执行鼠标移出事件;
                    $(".shopCar>div").triggerHandler("mouseleave");
                    this.listSum();
                }.bind(this));
            },
            addCar:function(event){
                var target = event.target ;
                var goodsId = $(target).attr("data-id");
                var cookie;
                if((cookie = $.cookie("shopCar"))){
                    // 将字符串转换为数组, 方便插入操作;
                    // console.log(cookie);
                    var cookieArray = JSON.parse(cookie);
                    // 判定当前要添加的商品 是否已经存在在购物车里;
                    // 表示是否存在商品;
                    var hasGoods = false;
                    for(var i = 0 ; i < cookieArray.length ; i ++){
                        if(cookieArray[i].id == goodsId ) {
                            // 存在 商品;
                            hasGoods = true;
                            cookieArray[i].num ++;
                            break;
                        }
                    }
                    // 如果没有商品;
                    if(hasGoods == false){
                        var goods = {
                            id : goodsId,
                            num : "1"
                        }
                        cookieArray.push(goods);
                    }

                    // 将数组 转为字符串 方便 储存cookie;

                    // console.log(JSON.stringify(cookieArray));
                    $.cookie("shopCar",JSON.stringify(cookieArray));
                }else{
                    $.cookie("shopCar",`[{"id":"${goodsId}","num":"1"}]`);
                }
                console.log($.cookie("shopCar"));
                this.listSum();
            },
            showList:function(event){
                // 判定是否存在购物车,如果不存在购物车就没必要拼接列表了;
                var target = event.target;

                if(target != $(".shopCar>div")[0]) return 0;

                var cookie;
                if(!(cookie = $.cookie("shopCar"))){ return 0; };
                var cookieArray = JSON.parse(cookie);

                var html = "";
                // for 购物车里有多少商品就拼接多少个;
                for(var i = 0 ; i < cookieArray.length ; i ++){
                    // console.log(cookieArray[i]);
                    // for 判断哪一个商品是购物车里的商品;
                    for(var j = 0 ; j < this.json.length ; j ++){
                        if(cookieArray[i].id == this.json[j].id){
                            html += `<li data-id="${cookieArray[i].id}">
                                        <img src="${this.json[j].images.small}" alt="">
                                        <h3>${this.json[j].title}</h3>
                                        <strong>${cookieArray[i].num}</strong>
                                    </li>`;
                            break;
                        }
                    }
                }
                
                $(".goods-list").html(html);
            },
            listSum:function(){
                var cookie;
                if(!(cookie = $.cookie("shopCar"))){ 
                    $(".shopCar").find("span").html(0);
                    return 0;
                };
                var cookieArray = JSON.parse(cookie);
                var sum = 0;
                for(var i = 0 ; i < cookieArray.length ; i ++){
                    sum += Number(cookieArray[i].num);
                }
                $(".shopCar").find("span").html(sum);
            }
        })
                var car = new ShopCar();
                car.init();
    
    
    </script>
</body>
</html>